<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>简易购物小程序</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <!-- 引入二维码生成库 (使用备用CDN) -->
    <script src="https://unpkg.com/qrcode@1.5.1/build/qrcode.min.js"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#10B981',
                        accent: '#F59E0B',
                        neutral: '#6B7280',
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .scrollbar-hide {
                -ms-overflow-style: none;
                scrollbar-width: none;
            }
            .scrollbar-hide::-webkit-scrollbar {
                display: none;
            }
            .card-shadow {
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            }
            .category-active {
                border-bottom: 3px solid theme('colors.primary');
                color: theme('colors.primary');
                font-weight: 600;
            }
            /* 按钮悬停效果 */
            .btn-hover {
                transition: all 0.2s;
                transform: scale(1);
            }
            .btn-hover:hover {
                transform: scale(1.1);
            }
        }
    </style>
</head>
<body class="bg-gray-50 font-sans">
    <!-- 导航栏 -->
    <header class="fixed top-0 left-0 right-0 bg-white shadow-sm z-50 transition-all duration-300" id="navbar">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <i class="fa fa-shopping-bag text-primary text-xl"></i>
                <h1 class="text-lg font-bold text-gray-800">便捷购物</h1>
            </div>
            <div class="flex items-center items-center space-x-4">
                <!-- 二维码按钮 -->
                <button id="qrcode-btn" class="relative text-gray-600 hover:text-primary p-2 btn-hover" aria-label="查看二维码">
                    <i class="fa fa-qrcode text-lg"></i>
                </button>
                <!-- 搜索按钮 -->
                <button id="search-btn" class="relative text-gray-600 hover:text-primary p-2 btn-hover" aria-label="搜索商品">
                    <i class="fa fa-search text-lg"></i>
                </button>
                <!-- 购物车按钮 -->
                <button id="cart-btn" class="relative relative text-gray-600 hover:text-primary p-2 btn-hover" aria-label="查看购物车">
                    <i class="fa fa-shopping-cart text-lg"></i>
                    <span class="absolute -top-2 -right-2 bg-accent text-white text-xs rounded-full h-5 w-5 flex items-center justify-center" id="cart-count">0</span>
                </button>
            </div>
        </div>
    </header>

    <!-- 搜索框 (默认隐藏) -->
    <div id="search-container" class="fixed top-16 left-0 right-0 bg-white px-4 py-3 shadow-md z-40 hidden">
        <div class="relative">
            <input type="text" id="search-input" placeholder="搜索商品..." 
                class="w-full py-2 px-10 rounded-full border border-gray-200 focus:outline-none focus:ring-2 focus:ring-primary/50">
            <i class="fa fa-search absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"></i>
            <button id="close-search" class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600">
                <i class="fa fa-times"></i>
            </button>
        </div>
    </div>

    <!-- 主内容区 -->
    <main class="container mx-auto px-4 pt-20 pb-20">
        <!-- 分类滚动栏 -->
        <div class="mb-6 overflow-x-auto scrollbar-hide">
            <div class="flex space-x-6 pb-2 min-w-max">
                <button class="category-item category-active py-2 whitespace-nowrap" data-category="all">全部商品</button>
                <button class="category-item py-2 whitespace-nowrap" data-category="food">食品饮料</button>
                <button class="category-item py-2 whitespace-nowrap" data-category="electronics">电子产品</button>
                <button class="category-item py-2 whitespace-nowrap" data-category="clothing">服装鞋帽</button>
                <button class="category-item py-2 whitespace-nowrap" data-category="home">家居用品</button>
                <button class="category-item py-2 whitespace-nowrap" data-category="beauty">美妆个护</button>
            </div>
        </div>

        <!-- 商品列表 -->
        <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4" id="product-grid">
            <!-- 商品将通过JavaScript动态加载 -->
        </div>
    </main>

    <!-- 商品详情模态框 -->
    <div id="product-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-lg max-w-lg w-full max-h-[90vh] overflow-y-auto transform transition-all">
            <div class="relative">
                <img id="modal-product-image" src="" alt="商品图片" class="w-full h-64 object-cover">
                <button id="close-modal" class="absolute top-4 right-4 bg-white bg-opacity-80 rounded-full p-2 shadow-md btn-hover">
                    <i class="fa fa-times text-gray-700"></i>
                </button>
            </div>
            <div class="p-6">
                <h2 id="modal-product-name" class="text-xl font-bold text-gray-800 mb-2"></h2>
                <p id="modal-product-category" class="text-sm text-neutral mb-4"></p>
                <div class="flex justify-between items-center mb-4">
                    <span id="modal-product-price" class="text-2xl font-bold text-primary"></span>
                    <div class="flex items-center">
                        <i class="fa fa-star text-accent"></i>
                        <span id="modal-product-rating" class="ml-1 text-gray-600"></span>
                    </div>
                </div>
                <p id="modal-product-description" class="text-gray-600 mb-6"></p>
                
                <div class="flex items-center justify-between border-t border-gray-100 pt-4">
                    <div class="flex items-center border rounded-full">
                        <button id="decrease-quantity" class="px-3 py-1 text-gray-600 hover:text-primary transition-colors">
                            <i class="fa fa-minus"></i>
                        </button>
                        <span id="quantity" class="px-3 py-1 min-w-[2rem] text-center">1</span>
                        <button id="increase-quantity" class="px-3 py-1 text-gray-600 hover:text-primary transition-colors">
                            <i class="fa fa-plus"></i>
                        </button>
                    </div>
                    <button id="add-to-cart" class="bg-primary hover:bg-primary/90 text-white px-6 py-2 rounded-full font-medium transition-all transform hover:scale-105">
                        <i class="fa fa-shopping-cart mr-2"></i>加入购物车
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 二维码模态框 -->
    <div id="qrcode-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-lg p-6 max-w-md w-full text-center transform transition-all scale-95 opacity-0" id="qrcode-modal-content">
            <h3 class="text-xl font-bold text-gray-800 mb-4">小程序入口二维码</h3>
            <div class="flex justify-center mb-4">
                <div id="qrcode-container" class="p-4 bg-white rounded shadow-lg">
                    <!-- 加载状态 -->
                    <div id="qrcode-loading" class="flex flex-col items-center justify-center h-50 w-50">
                        <div class="w-10 h-10 border-4 border-gray-200 border-t-primary rounded-full animate-spin mb-3"></div>
                        <p class="text-gray-500 text-sm">正在生成二维码...</p>
                    </div>
                    <!-- 二维码将在这里生成 -->
                </div>
            </div>
            <p id="qrcode-message" class="text-gray-600 mb-6">扫描上方二维码，进入便捷购物小程序</p>
            <button id="download-qrcode" class="bg-primary hover:bg-primary/90 text-white px-6 py-2 rounded-full font-medium transition-all" disabled>
                <i class="fa fa-download mr-2"></i>保存二维码
            </button>
            <button id="retry-qrcode" class="mt-3 bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-full text-sm transition-all hidden">
                <i class="fa fa-refresh mr-1"></i>重试生成
            </button>
        </div>
    </div>

    <!-- 购物车模态框 -->
    <div id="cart-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-lg max-w-md w-full max-h-[90vh] overflow-y-auto transform transition-all scale-95 opacity-0" id="cart-modal-content">
            <div class="p-6 border-b">
                <div class="flex justify-between items-center">
                    <h3 class="text-xl font-bold text-gray-800">我的购物车</h3>
                    <button id="close-cart" class="text-gray-500 hover:text-gray-700 p-2 btn-hover">
                        <i class="fa fa-times"></i>
                    </button>
                </div>
            </div>
            <div id="cart-items" class="p-6">
                <!-- 购物车为空时显示 -->
                <div id="empty-cart" class="text-center py-12">
                    <i class="fa fa-shopping-cart text-4xl text-gray-300 mb-4"></i>
                    <p class="text-gray-500">购物车还是空的</p>
                    <p class="text-gray-400 text-sm mt-2">快去添加商品吧~</p>
                </div>
                <!-- 购物车商品列表将动态生成 -->
            </div>
            <div class="p-6 border-t hidden" id="cart-summary">
                <div class="flex justify-between mb-4">
                    <span class="text-gray-600">合计:</span>
                    <span class="text-xl font-bold text-primary" id="cart-total">¥0.00</span>
                </div>
                <button id="checkout" class="w-full bg-primary hover:bg-primary/90 text-white py-3 rounded-full font-medium transition-all">
                    结算
                </button>
            </div>
        </div>
    </div>

    <!-- 底部导航 -->
    <footer class="fixed bottom-0 left-0 right-0 bg-white shadow-[0_-2px_10px_rgba(0,0,0,0.05)] z-40">
        <div class="flex justify-around py-3">
            <a href="#" class="flex flex-col items-center text-primary">
                <i class="fa fa-home text-xl mb-1"></i>
                <span class="text-xs">首页</span>
            </a>
            <a href="#" class="flex flex-col items-center text-gray-500 hover:text-primary transition-colors">
                <i class="fa fa-th-large text-xl mb-1"></i>
                <span class="text-xs">分类</span>
            </a>
            <a href="#" class="flex flex-col items-center text-gray-500 hover:text-primary transition-colors">
                <i class="fa fa-shopping-cart text-xl mb-1"></i>
                <span class="text-xs">购物车</span>
            </a>
            <a href="#" class="flex flex-col items-center text-gray-500 hover:text-primary transition-colors">
                <i class="fa fa-user text-xl mb-1"></i>
                <span class="text-xs">我的</span>
            </a>
        </div>
    </footer>

    <script>
        // 商品数据
        const products = [
            {
                id: 1,
                name: "有机草莓",
                category: "food",
                categoryName: "食品饮料",
                price: 29.9,
                image: "https://picsum.photos/seed/strawberry/300/300",
                description: "新鲜采摘的有机草莓，无农药残留，酸甜可口，富含维生素C。每盒约250g。",
                rating: 4.8
            },
            {
                id: 2,
                name: "无线蓝牙耳机",
                category: "electronics",
                categoryName: "电子产品",
                price: 199.0,
                image: "https://picsum.photos/seed/headphones/300/300",
                description: "高音质无线蓝牙耳机，续航可达24小时，IPX5防水，支持快充功能。",
                rating: 4.5
            },
            {
                id: 3,
                name: "纯棉T恤",
                category: "clothing",
                categoryName: "服装鞋帽",
                price: 89.0,
                image: "https://picsum.photos/seed/tshirt/300/300",
                description: "100%纯棉短袖T恤，透气舒适，多种颜色可选，适合日常穿着。",
                rating: 4.6
            },
            {
                id: 4,
                name: "陶瓷马克杯",
                category: "home",
                categoryName: "家居用品",
                price: 39.9,
                image: "https://picsum.photos/seed/mug/300/300",
                description: "创意陶瓷马克杯，容量350ml，耐高温，适合咖啡、茶等热饮。",
                rating: 4.7
            },
            {
                id: 5,
                name: "保湿面霜",
                category: "beauty",
                categoryName: "美妆个护",
                price: 129.0,
                image: "https://picsum.photos/seed/cream/300/300",
                description: "深层保湿面霜，适合各种肤质，含天然植物精华，持久滋润。",
                rating: 4.9
            }
        ];

        // 购物车数据
        let cart = [];

        // DOM元素
        const productGrid = document.getElementById('product-grid');
        const categoryItems = document.querySelectorAll('.category-item');
        const productModal = document.getElementById('product-modal');
        const closeModal = document.getElementById('close-modal');
        const modalProductImage = document.getElementById('modal-product-image');
        const modalProductName = document.getElementById('modal-product-name');
        const modalProductCategory = document.getElementById('modal-product-category');
        const modalProductPrice = document.getElementById('modal-product-price');
        const modalProductDescription = document.getElementById('modal-product-description');
        const modalProductRating = document.getElementById('modal-product-rating');
        const decreaseQuantity = document.getElementById('decrease-quantity');
        const increaseQuantity = document.getElementById('increase-quantity');
        const quantity = document.getElementById('quantity');
        const addToCartBtn = document.getElementById('add-to-cart');
        const navbar = document.getElementById('navbar');
        const qrcodeBtn = document.getElementById('qrcode-btn');
        const qrcodeModal = document.getElementById('qrcode-modal');
        const qrcodeModalContent = document.getElementById('qrcode-modal-content');
        const qrcodeContainer = document.getElementById('qrcode-container');
        const qrcodeLoading = document.getElementById('qrcode-loading');
        const qrcodeMessage = document.getElementById('qrcode-message');
        const downloadQrcode = document.getElementById('download-qrcode');
        const retryQrcode = document.getElementById('retry-qrcode');
        const searchBtn = document.getElementById('search-btn');
        const searchContainer = document.getElementById('search-container');
        const searchInput = document.getElementById('search-input');
        const closeSearch = document.getElementById('close-search');
        const cartBtn = document.getElementById('cart-btn');
        const cartModal = document.getElementById('cart-modal');
        const cartModalContent = document.getElementById('cart-modal-content');
        const closeCart = document.getElementById('close-cart');
        const cartItems = document.getElementById('cart-items');
        const emptyCart = document.getElementById('empty-cart');
        const cartSummary = document.getElementById('cart-summary');
        const cartTotal = document.getElementById('cart-total');
        const cartCount = document.getElementById('cart-count');
        const checkoutBtn = document.getElementById('checkout');

        // 初始化
        document.addEventListener('DOMContentLoaded', () => {
            renderProducts('all');
            // 预加载二维码生成函数，但不显示
            preloadQrcode();
            
            // 为所有交互元素绑定事件
            bindEvents();
        });

        // 绑定所有事件处理程序
        function bindEvents() {
            // 二维码相关事件
            qrcodeBtn.addEventListener('click', () => {
                qrcodeModal.classList.remove('hidden');
                setTimeout(() => {
                    qrcodeModalContent.classList.remove('scale-95', 'opacity-0');
                    qrcodeModalContent.classList.add('scale-100', 'opacity-100', 'transition-all', 'duration-300');
                }, 10);
                document.body.style.overflow = 'hidden';
                // 显示模态框时生成二维码
                generateQrcode();
            });

            retryQrcode.addEventListener('click', generateQrcode);

            // 其他事件绑定...
            // 分类按钮点击事件
            categoryItems.forEach(item => {
                item.addEventListener('click', () => {
                    categoryItems.forEach(btn => btn.classList.remove('category-active'));
                    item.classList.add('category-active');
                    const category = item.getAttribute('data-category');
                    renderProducts(category);
                    productGrid.scrollIntoView({ behavior: 'smooth', block: 'start' });
                });
            });

            // 关闭二维码模态框
            qrcodeModal.addEventListener('click', (e) => {
                if (e.target === qrcodeModal) {
                    closeQrcodeModal();
                }
            });

            // 搜索按钮点击事件
            searchBtn.addEventListener('click', () => {
                searchContainer.classList.toggle('hidden');
                if (!searchContainer.classList.contains('hidden')) {
                    searchInput.focus();
                }
            });

            // 关闭搜索框
            closeSearch.addEventListener('click', () => {
                searchContainer.classList.add('hidden');
            });

            // 搜索功能
            searchInput.addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase().trim();
                if (searchTerm) {
                    const filteredProducts = products.filter(product => 
                        product.name.toLowerCase().includes(searchTerm) || 
                        product.description.toLowerCase().includes(searchTerm)
                    );
                    renderFilteredProducts(filteredProducts);
                } else {
                    // 搜索为空时显示当前选中分类的商品
                    const activeCategory = document.querySelector('.category-active').getAttribute('data-category');
                    renderProducts(activeCategory);
                }
            });

            // 购物车按钮点击事件
            cartBtn.addEventListener('click', () => {
                cartModal.classList.remove('hidden');
                setTimeout(() => {
                    cartModalContent.classList.remove('scale-95', 'opacity-0');
                    cartModalContent.classList.add('scale-100', 'opacity-100', 'transition-all', 'duration-300');
                }, 10);
                document.body.style.overflow = 'hidden';
            });

            // 关闭购物车模态框
            closeCart.addEventListener('click', closeCartModal);
            cartModal.addEventListener('click', (e) => {
                if (e.target === cartModal) {
                    closeCartModal();
                }
            });

            // 关闭商品详情模态框
            closeModal.addEventListener('click', closeProductModal);
            productModal.addEventListener('click', (e) => {
                if (e.target === productModal) {
                    closeProductModal();
                }
            });

            // 数量调整
            decreaseQuantity.addEventListener('click', () => {
                let currentQuantity = parseInt(quantity.textContent);
                if (currentQuantity > 1) {
                    quantity.textContent = currentQuantity - 1;
                }
            });

            increaseQuantity.addEventListener('click', () => {
                let currentQuantity = parseInt(quantity.textContent);
                quantity.textContent = currentQuantity + 1;
            });

            // 加入购物车
            addToCartBtn.addEventListener('click', () => {
                const productId = parseInt(modalProductName.getAttribute('data-id'));
                const product = products.find(p => p.id === productId);
                const currentQuantity = parseInt(quantity.textContent);
                
                addToCart(product, currentQuantity);
                closeProductModal();
            });

            // 下载二维码
            downloadQrcode.addEventListener('click', downloadQrcodeImage);

            // 结算按钮
            checkoutBtn.addEventListener('click', () => {
                if (cart.length > 0) {
                    alert('跳转到结算页面...');
                    closeCartModal();
                }
            });

            // 滚动时改变导航栏样式
            window.addEventListener('scroll', () => {
                if (window.scrollY > 10) {
                    navbar.classList.add('shadow');
                    navbar.classList.remove('shadow-sm');
                } else {
                    navbar.classList.remove('shadow');
                    navbar.classList.add('shadow-sm');
                }
            });
        }

        // 预加载二维码生成库
        function preloadQrcode() {
            if (typeof QRCode === 'undefined') {
                // 如果QRCode库未加载，尝试重新加载
                const script = document.createElement('script');
                script.src = 'https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js';
                script.onload = () => console.log('二维码库加载成功');
                script.onerror = () => console.log('二维码库加载失败，将在打开时重试');
                document.head.appendChild(script);
            }
        }

        // 生成入口二维码（带错误处理和重试机制）
        function generateQrcode() {
            // 重置状态
            qrcodeContainer.querySelector('canvas')?.remove();
            qrcodeContainer.querySelector('img')?.remove();
            qrcodeLoading.classList.remove('hidden');
            qrcodeMessage.textContent = '正在生成二维码...';
            qrcodeMessage.className = 'text-gray-600 mb-6';
            downloadQrcode.disabled = true;
            retryQrcode.classList.add('hidden');

            // 使用备用URL，如果当前URL无法生成
            const url = window.location.href || 'https://example.com/shopping';
            
            try {
                // 检查QRCode是否加载
                if (typeof QRCode === 'undefined') {
                    throw new Error('二维码生成库未加载');
                }

                // 创建二维码
                const qrcode = new QRCode(qrcodeContainer, {
                    text: url,
                    width: 200,
                    height: 200,
                    colorDark: "#000000",
                    colorLight: "#ffffff",
                    correctLevel: QRCode.CorrectLevel.H
                });

                // 隐藏加载状态，显示成功状态
                setTimeout(() => {
                    qrcodeLoading.classList.add('hidden');
                    qrcodeMessage.textContent = '扫描上方二维码，进入便捷购物小程序';
                    downloadQrcode.disabled = false;
                }, 500);

            } catch (error) {
                console.error('生成二维码失败:', error);
                
                // 显示错误信息和重试按钮
                setTimeout(() => {
                    qrcodeLoading.classList.add('hidden');
                    qrcodeMessage.textContent = '二维码生成失败，请重试';
                    qrcodeMessage.className = 'text-red-500 mb-6';
                    retryQrcode.classList.remove('hidden');
                    
                    // 尝试备用生成方法 - 创建简单的二维码图片
                    const fallbackImg = document.createElement('img');
                    // 使用第三方API作为备用方案
                    fallbackImg.src = `https://api.qrserver.com/v1/create-qr-code/?data=${encodeURIComponent(url)}&size=200x200`;
                    fallbackImg.alt = '小程序入口二维码';
                    fallbackImg.className = 'max-w-full h-auto';
                    fallbackImg.onload = () => {
                        qrcodeMessage.textContent = '使用备用方案生成的二维码';
                        qrcodeMessage.className = 'text-amber-500 mb-6';
                        downloadQrcode.disabled = false;
                    };
                    qrcodeContainer.appendChild(fallbackImg);
                }, 1000);
            }
        }

        // 下载二维码图片
        function downloadQrcodeImage() {
            const canvas = qrcodeContainer.querySelector('canvas');
            const img = qrcodeContainer.querySelector('img');
            
            if (canvas) {
                // 从canvas下载
                const link = document.createElement('a');
                link.download = '购物小程序入口二维码.png';
                link.href = canvas.toDataURL('image/png');
                link.click();
            } else if (img) {
                // 从图片下载
                const link = document.createElement('a');
                link.download = '购物小程序入口二维码.png';
                link.href = img.src;
                link.click();
            } else {
                alert('无法获取二维码图片，请重试');
            }
        }

        // 关闭二维码模态框
        function closeQrcodeModal() {
            qrcodeModalContent.classList.remove('scale-100', 'opacity-100');
            qrcodeModalContent.classList.add('scale-95', 'opacity-0', 'transition-all', 'duration-300');
            
            setTimeout(() => {
                qrcodeModal.classList.add('hidden');
                document.body.style.overflow = '';
            }, 300);
        }

        // 关闭购物车模态框
        function closeCartModal() {
            cartModalContent.classList.remove('scale-100', 'opacity-100');
            cartModalContent.classList.add('scale-95', 'opacity-0', 'transition-all', 'duration-300');
            
            setTimeout(() => {
                cartModal.classList.add('hidden');
                document.body.style.overflow = '';
            }, 300);
        }

        // 打开商品详情模态框
        function openProductModal(product) {
            modalProductImage.src = product.image;
            modalProductImage.alt = product.name;
            modalProductName.textContent = product.name;
            modalProductName.setAttribute('data-id', product.id);
            modalProductCategory.textContent = product.categoryName;
            modalProductPrice.textContent = `¥${product.price.toFixed(2)}`;
            modalProductDescription.textContent = product.description;
            modalProductRating.textContent = product.rating;
            quantity.textContent = '1';
            
            productModal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        // 关闭商品详情模态框
        function closeProductModal() {
            productModal.classList.add('hidden');
            document.body.style.overflow = '';
        }

        // 渲染商品列表
        function renderProducts(category) {
            productGrid.innerHTML = '';
            
            let filteredProducts = products;
            if (category !== 'all') {
                filteredProducts = products.filter(product => product.category === category);
            }
            
            renderFilteredProducts(filteredProducts);
        }

        // 渲染过滤后的商品
        function renderFilteredProducts(filteredProducts) {
            productGrid.innerHTML = '';
            
            if (filteredProducts.length === 0) {
                productGrid.innerHTML = `
                    <div class="col-span-full py-12 text-center">
                        <i class="fa fa-search text-4xl text-gray-300 mb-4"></i>
                        <p class="text-gray-500">没有找到匹配的商品</p>
                    </div>
                `;
                return;
            }
            
            filteredProducts.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'bg-white rounded-lg overflow-hidden card-shadow hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1 cursor-pointer';
                productCard.innerHTML = `
                    <div class="relative">
                        <img src="${product.image}" alt="${product.name}" class="w-full h-48 object-cover">
                        <div class="absolute top-2 right-2 bg-white bg-opacity-80 rounded-full p-1 btn-hover">
                            <i class="fa fa-heart-o text-gray-500 hover:text-red-500 transition-colors"></i>
                        </div>
                    </div>
                    <div class="p-3">
                        <div class="text-xs text-neutral mb-1">${product.categoryName}</div>
                        <h3 class="font-medium text-gray-800 mb-1 line-clamp-1">${product.name}</h3>
                        <div class="flex justify-between items-center">
                            <span class="text-primary font-bold">¥${product.price.toFixed(2)}</span>
                            <div class="flex items-center text-xs">
                                <i class="fa fa-star text-accent mr-1"></i>
                                <span>${product.rating}</span>
                            </div>
                        </div>
                    </div>
                `;
                
                productCard.addEventListener('click', () => {
                    openProductModal(product);
                });
                
                productGrid.appendChild(productCard);
            });
        }

        // 添加商品到购物车
        function addToCart(product, quantity) {
            const existingItem = cart.find(item => item.id === product.id);
            
            if (existingItem) {
                existingItem.quantity += quantity;
            } else {
                cart.push({
                    ...product,
                    quantity: quantity
                });
            }
            
            updateCartDisplay();
            showToast(`已添加 ${product.name} x ${quantity} 到购物车`);
        }

        // 从购物车移除商品
        function removeFromCart(productId) {
            cart = cart.filter(item => item.id !== productId);
            updateCartDisplay();
        }

        // 更新购物车中商品数量
        function updateCartItemQuantity(productId, newQuantity) {
            if (newQuantity < 1) return;
            
            const item = cart.find(item => item.id === productId);
            if (item) {
                item.quantity = newQuantity;
                updateCartDisplay();
            }
        }

        // 更新购物车显示
        function updateCartDisplay() {
            const totalItems = cart.reduce((total, item) => total + item.quantity, 0);
            cartCount.textContent = totalItems;
            
            cartItems.innerHTML = '';
            
            if (cart.length === 0) {
                emptyCart.classList.remove('hidden');
                cartSummary.classList.add('hidden');
                return;
            }
            
            emptyCart.classList.add('hidden');
            cartSummary.classList.remove('hidden');
            
            let total = 0;
            
            cart.forEach(item => {
                total += item.price * item.quantity;
                
                const cartItem = document.createElement('div');
                cartItem.className = 'flex items-center py-3 border-b last:border-0';
                cartItem.innerHTML = `
                    <img src="${item.image}" alt="${item.name}" class="w-16 h-16 object-cover rounded mr-3">
                    <div class="flex-1">
                        <h4 class="font-medium text-gray-800 line-clamp-1">${item.name}</h4>
                        <p class="text-primary font-medium">¥${item.price.toFixed(2)}</p>
                    </div>
                    <div class="flex items-center">
                        <button class="decrease-cart-item px-2 py-1 text-gray-600 hover:text-primary" data-id="${item.id}">
                            <i class="fa fa-minus"></i>
                        </button>
                        <span class="px-2">${item.quantity}</span>
                        <button class="increase-cart-item px-2 py-1 text-gray-600 hover:text-primary" data-id="${item.id}">
                            <i class="fa fa-plus"></i>
                        </button>
                        <button class="remove-cart-item ml-2 text-gray-400 hover:text-red-500" data-id="${item.id}">
                            <i class="fa fa-trash"></i>
                        </button>
                    </div>
                `;
                
                cartItems.appendChild(cartItem);
            });
            
            cartTotal.textContent = `¥${total.toFixed(2)}`;
            
            document.querySelectorAll('.decrease-cart-item').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const productId = parseInt(e.currentTarget.getAttribute('data-id'));
                    const item = cart.find(item => item.id === productId);
                    updateCartItemQuantity(productId, item.quantity - 1);
                });
            });
            
            document.querySelectorAll('.increase-cart-item').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const productId = parseInt(e.currentTarget.getAttribute('data-id'));
                    const item = cart.find(item => item.id === productId);
                    updateCartItemQuantity(productId, item.quantity + 1);
                });
            });
            
            document.querySelectorAll('.remove-cart-item').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const productId = parseInt(e.currentTarget.getAttribute('data-id'));
                    removeFromCart(productId);
                });
            });
        }

        // 显示提示消息
        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'fixed bottom-20 left-1/2 -translate-x-1/2 bg-gray-800 text-white px-4 py-2 rounded-full shadow-lg z-50 opacity-0 transition-opacity duration-300';
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.classList.remove('opacity-0');
                toast.classList.add('opacity-90');
            }, 10);
            
            setTimeout(() => {
                toast.classList.remove('opacity-90');
                toast.classList.add('opacity-0');
                
                setTimeout(() => {
                    document.body.removeChild(toast);
                }, 300);
            }, 3000);
        }
    </script>
</body>
</html>
